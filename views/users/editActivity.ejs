<script src="/javascripts/fileUpload/js/vendor/jquery.ui.widget.js"></script>
<script src="/javascripts/fileUpload/js/jquery.iframe-transport.js"></script>
<script src="/javascripts/fileUpload/js/jquery.fileupload.js"></script>



<input type="hidden" id="activityId" />

<div class="modal fade" id="myModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                ×
                            </button>
                            <h4 class="modal-title" id="myModalLabel">
                                编辑商品
                            </h4>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    上传商品图片:
                                    <input type="file" name="file4" id="file4" placeholder="请选择文件">
                                </div>
                            </div>
                            <div class="row">
                                <br/>
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <img width="100%" src="#" alt="" id="itemImage">
                                </div>
                            </div>
                                <br/>
                            <div class="row">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div class="input-group">
                                        <input id="itemName" type="text" class="form-control" placeholder="输入商品名称"/>
                                        <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                                    </div>
                                </div>
                            </div>
                                <br/>
                            <div class="row">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div class="input-group">
                                        <input id="itemDesc" type="text" class="form-control" placeholder="输入商品描述"/>
                                        <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                    <div class="input-group">
                                        <input id="itemUprice" type="text" class="form-control" placeholder="输入商品单价(元)"/>
                                        <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                    <div class="input-group">
                                        <input id="itemUom" type="text" class="form-control" placeholder="输入商品单位"/>
                                        <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                                    </div>
                                </div>
                            </div>
                                <br/>
                            <div class="row">
                                <div class="col-lg-3 col-md-6 col-sm-3 col-xs-12">
                                    所属模块: <select class="form-control" id="moduleOptions" >

                                    </select>
                                </div>
                            </div>
                                <br/>
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                    <label id="modalMessage" style="color:red"></label>
                                </div>
                            </div>

                            <input type="hidden" id="modalItemId" />

                        </div>
                        <div class="modal-footer">

                            <button type="button" class="btn btn-default" data-dismiss="modal">
                                取消
                            </button>
                            <button type="button" class="btn btn-primary" onclick="saveItem()">
                                保存
                            </button>
                        </div>
                    </div>

                </div>

            </div>

<br/>
<br/>


<div class="container-fluid">
    <div class="row">
        <!--左边保存按钮等-->
        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
            <div class="panel panel-default text-center">
            <div class="panel-heading">
                <h3 class="panel-title">
                    编辑活动
                </h3>
            </div>
            <div class="panel-body">
                <button class="button button-primary" onclick="save()">保存</button>
                <button class="button button-action" onclick="preview()">预览</button>
                <button class="button button-highlight" onclick="reset()">重置</button>
                <button class="button button-royal" onclick="goback()">返回</button>
            </div>
            <div class="panel-footer">

            </div>
        </div>
        </div>
        <!--右边活动编辑区域-->
        <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
            <!--活动命名-->
            <div class="panel panel-default text-center">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        为你的活动命名(必须)
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class=" col-lg-3 col-md-3 col-sm-3 col-xs-12">
                            <div class="input-group">
                                <input name="activityName" id="activityName" type="text" class="form-control" placeholder="输入活动名"/>
                                <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                            <div class="checkbox">
                                <label>
                                    <input name="enable" id="enable" type="checkbox" checked='checked' >启用
                                </label>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="input-group">
                                <input name="activityDesc" id="activityDesc" type="text" class="form-control" placeholder="输入活动的概要描述"/>
                                <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="input-group">
                                <input name="contactInfo" id="contactInfo" type="text" class="form-control" placeholder="输入联系人信息或地址信息"/>
                                <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--设置活动背景-->
            <!--<div class="panel panel-default text-center">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        选择活动的主题背景(可选)
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                            <div class="text-center">
                                <img src="/images/100_1.jpeg"><br/>
                                <label class="radio-inline">
                                    <input type="radio" name="theme">
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                            <div class="text-center">
                                <img src="/images/100_2.jpeg"><br/>
                                <label class="radio-inline">
                                    <input type="radio" name="theme">
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                            <div class="text-center">
                                <img src="/images/100_3.jpeg"><br/>
                                <label class="radio-inline">
                                    <input type="radio" name="theme">
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
                            <div class="text-center">
                                <img src="/images/100_4.jpeg"><br/>
                                <label class="radio-inline">
                                    <input type="radio" name="theme">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>-->
            <!--设置活动宣传栏-->
            <div class="panel panel-default text-center">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        为活动设置宣传栏(可选)
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                            <input type="file" name="file1" placeholder="第一幅宣传图片" id="file1">
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-6">
                            <input type="button" class="button button-primary button-small" value="清除" onclick="clearFile('uploadMessage1')">
                        </div>
                        <div class="col-lg-7 col-md-7 col-sm-7 col-xs-6">
                            <label id="uploadMessage1" style="color:red"></label>
                            <input type="hidden" id="file1Path" />
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="input-group">
                                <input id="fileText1" type="text" class="form-control" placeholder="输入第一幅图片的描述文字"/>
                                <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                            <input type="file" name="file2" placeholder="第二幅宣传图片" id="file2">
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                            <input type="button" class="button button-primary button-small" value="清除" onclick="clearFile('uploadMessage2')">
                        </div>
                        <div class="col-lg-7 col-md-7 col-sm-7 col-xs-6">
                            <label id="uploadMessage2" style="color:red"></label>
                            <input type="hidden" id="file2Path" />
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="input-group">
                                <input id="fileText2" type="text" class="form-control" placeholder="输入第二幅图片的描述文字"/>
                                <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                            <input type="file" name="file3" placeholder="第三幅宣传图片" id="file3">
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-6">
                            <input type="button" class="button button-primary button-small" value="清除" onclick="clearFile('uploadMessage3')">
                        </div>
                        <div class="col-lg-7 col-md-7 col-sm-7 col-xs-6">
                            <label id="uploadMessage3" style="color:red"></label>
                            <input type="hidden" id="file3Path" />
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="input-group">
                                <input id="fileText3" type="text" class="form-control" placeholder="输入第三幅图片的描述文字"/>
                                <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--设置活动板块-->
            <div class="panel panel-default text-center">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        为活动设置版块(必须)
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class=" col-lg-3 col-md-3 col-sm-3 col-xs-8">
                            <div class="input-group">
                                <input id="moduleName" type="text" class="form-control" placeholder="输入模块名"/>
                                <span class="input-group-addon"><i class="fa fa-keyboard-o"></i></span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                            <button class="button button-primary button-small" onclick="addModule()">添加</button>
                        </div>
                    </div>
                    <br/>
                    <div class="row text-left">
                        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                            模块列表
                            <hr/>
                            <div id="moduleList">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--为板块添加内容-->
            <div class="panel panel-default text-center">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        为板块添加内容(必须)
                    </h3>
                </div>
                <div class="panel-body" id="modules">
                    <div class="row">
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-4">
                            <button class="button button-primary button-small" onclick="addItem()">新增商品</button>
                        </div>
                    </div>
                    <hr/>
                    <div class="row" id="itemList">

                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<!--<script src="/javascripts/ckeditor/ckeditor.js"></script>-->
<script>


    var _moduleList=new Array();
    var _moduleContent=new Array();



    function addModule()
    {
        var name=$('#moduleName').val();
        if(name=="")
        {
            return ;
        }
        else
        {
            if(isModuleNameExists(name))
            {
                alert('模块名称已存在列表中，请核对');
                return ;
            }
            else
            {
                _moduleList.push({'name':name});
                setModuleList(name);
                addToOptions(name)
                return;
            }

        }
    }

    <!--在模块编辑栏的下拉列表中添加-->
    function addToOptions(name)
    {
        var op =$('#moduleOptions').get(0);
        for(var i=0;i<=op.options.length-1;i++)
        {
            if(op.options[i].text==name)
            {
                return;
            }
        }
        var item=new Option(name);
        op.options.add(item);
    }

    <!--在模块列表中添加模块名-->
    function setModuleList(name)
    {
        var parent=$('#moduleList').get(0);
        var child=document.createElement("div");
        child.setAttribute('id',name);

        var grandChild2=document.createElement('button');
        grandChild2.setAttribute('style',"color: red");
        grandChild2.setAttribute('onclick',"removeFromModuleList('"+name+"')");
        grandChild2.innerHTML='<i class="fa fa-close"></i>';
        child.appendChild(grandChild2);

        var grandChild1=document.createElement('label');
        grandChild1.innerHTML=name;
        grandChild1.setAttribute('style',"margin-left:15px");
        child.appendChild(grandChild1);

        parent.appendChild(child);
    }

    <!--从模块列表中删除模块-->
    function removeFromModuleList(name)
    {
        var parent=$('#moduleList').get(0);
        var child=$('#'+name).get(0);
        var count =countsInModule(name);
        if(count!=0)//如果模块中没有任何内容，那么可以直接删除模块，否则提示用户
        {
            if(confirm('模块['+name+']中包含了'+count+'件商品，删除模块将删除所有商品，是否继续？'))
            {
                //删除页面中的元素
                parent.removeChild(child);
                //删除_moduleList中的元素
                for(var i in _moduleList)
                {
                    if(_moduleList[i].name==name)
                    {
                        _moduleList.splice(i,1);
                        break;
                    }
                }
                //删除下拉菜单中的元素
                var op =$('#moduleOptions').get(0);
                for(var i=0;i<=op.options.length-1;i++)
                {
                    if(op.options[i].text==name)
                    {
                        op.options[i]=null;
                    }
                }
                //删除_moduleContent中的元素

                for(var j=0;j<_moduleContent.length;j++)
                {
                    if(_moduleContent[j].moduleName==name)
                    {
                        document.getElementById('itemList').removeChild(document.getElementById('item'+_moduleContent[j].itemId));

                        _moduleContent.splice(j,1);
                        j--;
                    }
                }

            }
            else
            {
                return;
            }
        }
        else
        {
            //删除页面中的元素
            parent.removeChild(child);
            //删除_moduleList中的元素
            for(var i in _moduleList)
            {
                if(_moduleList[i].name==name)
                {
                    _moduleList.splice(i,1);
                    break;
                }
            }
            //删除下拉菜单中的元素
            var op =$('#moduleOptions').get(0);
            for(var i=0;i<=op.options.length-1;i++)
            {
                if(op.options[i].text==name)
                {
                    op.options[i]=null;
                }
            }
        }
    }

    //获取模块中对应的商品数量
    function countsInModule(moduleName)
    {
        var count=0;
        for(var i in _moduleContent)
        {
            if(_moduleContent[i].moduleName==moduleName)
            {
                count++;
            }
        }
        return count;
    }

    <!-- 判断模块名是否已存在-->
    function isModuleNameExists(name)
    {
        for(var i in _moduleList)
        {
            if(_moduleList[i].name==name)
            {
                return true;
            }
        }
        return false;
    }

    <!-- 保存活动页面内容-->
    function save()
    {
        //验证用户活动名
        var name=$('#activityName').val();
        if(name.trim()=='' || name.trim()==null)
        {
            alert('请输入您的活动名称!');
            return;
        }

        var exp =new RegExp('^[a-zA-Z0-9\\u4E00-\\u9FA5]{1,10}$');//验证活动名是否汉字、字母或数字的组合，其他字符不允许
        if(!exp.test($('#activityName').val()))
        {
            alert('请输入10个以内的字符作为活动名，汉字、字母及数字的组合都可以!');
            return;
        }

        //验证用户活动描述
        var desc=$('#activityDesc').val();
        if(desc.trim()=='' || desc.trim()==null)
        {
            alert('请输入您的活动描述!');
            return;
        }

        var exp =new RegExp('^[a-zA-Z0-9\\u4E00-\\u9FA5]{1,100}$');//验证活动描述是否汉字、字母或数字的组合，其他字符不允许
        if(!exp.test(desc))
        {
            alert('请输入100个以内的字符作为活动描述，汉字、字母及数字的组合都可以!');
            return;
        }

        //验证用户活动联系信息
        var contact=$('#contactInfo').val();
        if(contact.trim()=='' || contact.trim()==null)
        {
            alert('请输入您的联系信息!');
            return;
        }

        var exp =new RegExp('^[a-zA-Z0-9\\u4E00-\\u9FA5]{1,50}$');//验证活动描述是否汉字、字母或数字的组合，其他字符不允许
        if(!exp.test(contact))
        {
            alert('请输入50个以内的字符作为联系信息!');
            return;
        }

        if(_moduleList.length==0)//检查是否添加了模块
        {
            alert('当前活动没有任何模块，请添加至少一个！');
            return;
        }

        if(!document.getElementById('enable').checked)
        {
            if(!confirm('注意：您尚未选择启用此活动，内容将不公开显示，是否继续？'))
            {
                return;
            }
        }


        //post数据，进行保存
        var data={
            'activityId':$('#activityId').val()==null?'':$('#activityId').val(),
            'activityName':name,
            'activityDesc':desc,
            'enabled':document.getElementById('enable').checked?true:false,
            'contactInfo':contact,
            'pic1':$('#file1Path').val()==null?'':$('#file1Path').val(),
            'pic1Desc':$('#fileText1').val()==null?'':$('#fileText1').val(),
            'pic2':$('#file2Path').val()==null?'':$('#file2Path').val(),
            'pic2Desc':$('#fileText2').val()==null?'':$('#fileText2').val(),
            'pic3':$('#file3Path').val()==null?'':$('#file3Path').val(),
            'pic3Desc':$('#fileText3').val()==null?'':$('#fileText3').val(),
            'moduleList':_moduleList,
            'moduleContent':_moduleContent};
        $.post('/users/saveActivity',
                {'data':data},
                function(data){
                    if(data.success)
                    {
                        $('#activityId').val(data.activityId);
                        alert(data.message);
                    }
                    else
                    {
                        alert(data.message);
                    }

        });

    }

    function goback()
    {
        history.go(-1);
    }

    <!-- 重置活动页面-->
    function reset()
    {
        location.reload(true);
    }

    function preview()
    {
        var win=window.open('/users/previewActivity');
    }

    function addItem()
    {
        var itemid=uuid(16,16);
        var list=document.getElementById('itemList');


        var item=document.createElement('div');
        item.setAttribute('class','thumbnail col-lg-3 col-md-3 col-sm-3 col-xs-4');
        item.setAttribute('id','item'+itemid+'');

        var itemImg=document.createElement('img');
        itemImg.setAttribute('src','/images/logo.png');
        itemImg.setAttribute('width','100%');
        itemImg.setAttribute('id','thumbNailImgId_'+itemid);

        var capDiv=document.createElement('div');
        capDiv.setAttribute('class','caption');

        var title=document.createElement('label');
        title.setAttribute('id','thumbNailItemName_'+itemid);
        title.innerHTML='商品名称';

        var pp=document.createElement('p');
        var price=document.createElement('label');
        var spliter=document.createElement('label');
        var uom=document.createElement('label');
        price.setAttribute('id','thumbNailUprice_'+itemid);
        uom.setAttribute('id','thumbNailUom_'+itemid);
        spliter.innerHTML='/';
        pp.appendChild(price);
        pp.appendChild(spliter);
        pp.appendChild(uom);

        var p2=document.createElement('p');
        var a3=document.createElement('a');
        a3.setAttribute('class','btn btn-info');
        a3.setAttribute('onclick','editItem("'+itemid+'")');
        a3.innerHTML='编辑';
        var a4=document.createElement('a');
        a4.setAttribute('class','btn btn-danger');

        a4.setAttribute('onclick','delItem("'+itemid+'")');
        a4.setAttribute('style','margin-left:15px');
        a4.innerHTML='删除';
        p2.appendChild(a3);
        p2.appendChild(a4);

        var module=document.createElement('input');
        module.setAttribute('type','hidden');
        module.setAttribute('id','thumbNailModuleName_'+itemid);

        capDiv.appendChild(title);
        capDiv.appendChild(pp);
        capDiv.appendChild(p2);

        item.appendChild(itemImg);
        item.appendChild(capDiv);
        item.appendChild(module);

        list.appendChild(item);



    }

    function delItem(id)
    {
        //从_moduleContent中清除商品信息
        var module = document.getElementById('thumbNailModuleName_'+id).value;
        var itemname = document.getElementById('thumbNailItemName_'+id).innerHTML;
        var list=document.getElementById('itemList');
        var item=document.getElementById('item'+id);
        if(module==''||module==null)
        {
            //如果是新增的空的商品，则从页面中清除商品项目

            list.removeChild(item);
        }else
        {
            //如果是已经编辑过的商品，则不但要清除页面信息，也要清除_moduleContent中的信息
            for(var i in _moduleContent)
            {
                if(_moduleContent[i].moduleName==module && _moduleContent[i].itemName==itemname)
                {
                    _moduleContent.splice(i,1);
                    break;
                }
            }
            //从页面中清除商品项目
            list.removeChild(item);
        }
    }

    function editItem(id)
    {
        var img = $('#thumbNailImgId_'+id).attr('src');
        if(img=='/images/logo.png'||img==null)
        {
            resetModal();
            $('#modalItemId').val(id);
            $('#myModal').modal('show');
        }
        else
        {
            resetModal();
            $('#itemImage').attr('src',img);
            $('#itemName').val($('#thumbNailItemName_'+id).html());
            $('#itemDesc').val($('#thumbNailImgId_'+id).attr('alt'));
            $('#itemUprice').val($('#thumbNailUprice_'+id).html());
            $('#itemUom').val($('#thumbNailUom_'+id).html());
            $('#modalItemId').val(id);
            $('#moduleOptions').val($('#thumbNailModuleName_'+id).val());
            $('#myModal').modal('show');
        }
    }

    //将商品信息回传到缩略图中
    function saveItem()
    {
        var id=$('#modalItemId').val();
        //检查图片是否上传
        var img=$('#itemImage').attr('src');
        if(img=='' || img==null)
        {
            $('#modalMessage').html('请选择商品图片!');
            return;
        }

        //检查商品名称
        var name=$('#itemName').val();
        if(name.trim()=='' || name.trim()==null)//验证用户是否输入商品名
        {
            $('#modalMessage').html('请输入商品名称!');
            return;
        }

        var exp =new RegExp('^[a-zA-Z0-9\\u4E00-\\u9FA5]{1,15}$');//验证商品名是否汉字、字母或数字的组合，其他字符不允许
        if(!exp.test($('#itemName').val()))
        {
            $('#modalMessage').html('请输入15个字符以内的汉字或数字或字母的组合的商品名称!');
            return;
        }

        //检查是否存在同名商品,除了更新，否则不允许出现同名商品
        for(var i in _moduleContent)
        {
            if(_moduleContent[i].itemName==name)
            {
                if(_moduleContent[i].itemId != id)
                {
                    alert('模块'+_moduleContent[i].moduleName+'中已存在同名商品，请检查!');
                    return;
                }
            }
        }

        //检查商品描述
        var desc=$('#itemDesc').val();
        if(desc.trim()=='' || desc.trim()==null)//验证用户是否输入商品描述
        {
            $('#modalMessage').html('请输入商品描述!');
            return;
        }

        exp =new RegExp('^[a-zA-Z0-9\\u4E00-\\u9FA5]{1,100}$');//验证商品名是否汉字、字母或数字的组合，其他字符不允许
        if(!exp.test($('#itemDesc').val()))
        {
            $('#modalMessage').html('请输入100个字符以内的汉字或数字或字母的组合作为商品描述!');
            return;
        }

        //检查商品单价
        var price=$('#itemUprice').val();
        if(price.trim()=='' || price.trim()==null)//验证用户是否输入商品单价
        {
            $('#modalMessage').html('请输入商品单价!');
            return;
        }


        if(isNaN($('#itemUprice').val()))
        {
            $('#modalMessage').html('请输入纯数字作为商品单价!');
            return;
        }

        //检查商品单位
        var uom=$('#itemUom').val();
        if(uom.trim()=='' || uom.trim()==null)//验证用户是否输入商品单位
        {
            $('#modalMessage').html('请输入商品单位!');
            return;
        }


        exp =new RegExp('^[a-zA-Z0-9\\u4E00-\\u9FA5]{1,10}$');//验证商品名是否汉字、字母或数字的组合，其他字符不允许
        if(!exp.test($('#itemUom').val()))
        {
            $('#modalMessage').html('请输入10个字符以内的汉字或数字或字母的组合作为商品单位!');
            return;
        }

        //检查是否选择了模块
        var module =$('#moduleOptions').val();
        if(module=='' || module==null)
        {
            $('#modalMessage').html('请选择所属模块!');
            return;
        }

        //验证完成后设置商品的缩略图
        $('#thumbNailImgId_'+id).attr('src',img);
        $('#thumbNailImgId_'+id).attr('alt',desc);
        $('#thumbNailItemName_'+id).html(name);
        $('#thumbNailUprice_'+id).html(price);
        $('#thumbNailUom_'+id).html(uom);
        $('#thumbNailModuleName_'+id).val(module);
        $('#myModal').modal('hide');

        //保存商品信息至_moduleContent
        for(var k in _moduleContent)
        {
            if(_moduleContent[k].itemId==id)
            {
                _moduleContent.splice(k,1);
                break;
            }
        }
        _moduleContent.push({"moduleName":module,"itemName":name,"itemDesc":desc,"image":img,"price":price,"uom":uom,"itemId":id});

    }

    //清除上传的宣传图片
    function clearFile(file)
    {
        document.getElementById(file).innerHTML='';
    }

    //重置模态窗口中的信息
    function resetModal()
    {
        $('#file4').val('');
        $('#itemImage').attr('src','');
        $('#itemName').val('');
        $('#itemDesc').val('');
        $('#itemUprice').val('');
        $('#itemUom').val('');
        $('#modalMessage').html('');
        $('#modalItemId').val('');
        $('#moduleOptions').get(0).selectedIndex=0;

    }




    //用于上传宣传图片
    $("#file1").fileupload({
        url:"/upload?type=temp&tag=file1",//处理程序的地址，当然也可以直接写在input的data-url属性内
        done:function(e,result){
            if(result.result.file==null)
            {
                $('#uploadMessage1').html(result.result);
            }
            else
            {
                $('#uploadMessage1').html('上传成功！');
                $('#file1Path').val(result.result.file);
            }
        }
    });

    $("#file2").fileupload({
        url:"/upload?type=temp&tag=file2",//处理程序的地址，当然也可以直接写在input的data-url属性内
        done:function(e,result){
            if(result.result.file==null)
            {
                $('#uploadMessage2').html(result.result);
            }
            else
            {
                $('#uploadMessage2').html('上传成功！');
                $('#file2Path').val(result.result.file);
            }

        }
    });


    $("#file3").fileupload({
        url:"/upload?type=temp&tag=file3",//处理程序的地址，当然也可以直接写在input的data-url属性内
        done:function(e,result){
            if(result.result.file==null)
            {
                $('#uploadMessage3').html(result.result);
            }
            else
            {
                $('#uploadMessage3').html('上传成功！');
                $('#file3Path').val(result.result.file);
            }
        }
    });

    //用于上传商品图片
    $("#file4").fileupload({
        url:"/upload?type=temp&tag=file4",//处理程序的地址，当然也可以直接写在input的data-url属性内
        done:function(e,result){
            $('#itemImage').attr('src','/tmp/'+result.result.file);
        }
    });

    this.document._moduleContent=_moduleContent;
    this.document._moduleList=_moduleList;
</script>



